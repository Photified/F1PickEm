<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 2026: CHAMPIONSHIP BINGO</title>
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,400;0,700;0,900;1,400&display=swap" rel="stylesheet">
    <script src="bingo_data.js"></script>

    <style>
        :root {
            --brand-red: #e10600; --brand-dark: #15151e; --bg-body: #f4f4f8;
            --score-win: #39ff14; 
        }
        body { font-family: 'Titillium Web', sans-serif; background: var(--bg-body); color: var(--brand-dark); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .hidden { display: none !important; }

        /* HEADER */
        header { background: white; border-bottom: 3px solid var(--brand-red); padding: 10px 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); z-index: 20; flex-shrink: 0; }
        .header-title { font-weight:900; font-style:italic; font-size:24px; cursor: pointer; user-select: none; letter-spacing: -0.5px; }
        .status-dot { width: 10px; height: 10px; background: #ccc; border-radius: 50%; display:inline-block; margin-right:5px; }

        /* RACE BAR */
        .race-bar { background: #fff; padding: 0; display: flex; overflow-x: auto; border-bottom: 1px solid #ddd; scrollbar-width: thin; height: 90px; flex-shrink: 0; }
        .race-card { flex: 0 0 85px; padding: 10px 5px; text-align: center; border-right: 1px solid #f0f0f0; cursor: pointer; opacity: 0.6; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .race-card.active { opacity: 1; border-bottom: 4px solid var(--brand-red); background: #fff; }
        .race-flag-img { width: 36px; height: 26px; object-fit: cover; border-radius: 3px; margin-bottom: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .race-name { font-size: 11px; font-weight: 800; text-transform: uppercase; line-height: 1; margin-top: 2px; }

        /* MAIN GRID */
        .main-stage { flex: 1; display: grid; grid-template-columns: 320px 1fr 280px; padding: 20px; gap: 20px; overflow: hidden; height: 100%; }
        .panel { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); overflow: hidden; display: flex; flex-direction: column; border: 1px solid #e0e0e0; height: 100%; }
        .panel-header { padding: 15px; background: #f8f8f8; font-weight: 800; font-size: 14px; text-transform: uppercase; border-bottom: 1px solid #ddd; text-align: center; color: #444; flex-shrink: 0; }

        /* BUILDER POOL (Left) */
        .builder-container { padding: 15px; display: flex; flex-direction: column; gap: 10px; height: 100%; overflow-y: auto; }
        .builder-label { font-size: 11px; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 5px; }
        .builder-select { width: 100%; padding: 10px; border: 2px solid #eee; border-radius: 6px; font-family: inherit; font-weight: 600; cursor: pointer; }
        .builder-select:focus { border-color: var(--brand-red); outline: none; }
        .add-btn { background: var(--brand-red); color: white; border: none; padding: 12px; width: 100%; border-radius: 6px; font-weight: 900; cursor: pointer; text-transform: uppercase; margin-top: 10px; }
        .add-btn:hover { background: #b00; }
        
        .chaos-list { margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; }
        .chaos-chip { padding: 8px 12px; background: #f0f0f0; border-radius: 4px; font-size: 11px; font-weight: 700; margin-bottom: 5px; cursor: pointer; border-left: 4px solid #555; }
        .chaos-chip:hover { background: #ddd; }

        /* CENTER */
        .active-panel { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 1px solid #e0e0e0; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden; height: 100%; }
        .bingo-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; width: 100%; aspect-ratio: 1/1; margin: 0 auto; max-height: 650px; }
        
        .slot { 
            background: #fafafa; border: 3px dashed #ddd; border-radius: 10px; 
            display: flex; align-items: center; justify-content: center; text-align: center; 
            padding: 5px; font-size: 12px; font-weight: 800; position: relative; user-select: none;
            cursor: pointer; transition: 0.2s; color: #aaa;
        }
        .slot:hover { border-color: #bbb; background: #f4f4f4; }
        .slot.selected-target { border-color: var(--brand-red); background: #fff0f0; color: var(--brand-red); }

        .slot.filled { 
            border: 2px solid #eee; background: white; color: var(--brand-dark); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); opacity: 1; font-size: 13px; line-height: 1.2;
        }
        
        .slot.center { 
            background: linear-gradient(135deg, #222, #444) !important; 
            color: #fff !important; border: 2px solid var(--brand-red) !important; 
            font-size: 16px; text-transform: uppercase; opacity: 1 !important; 
            display: flex; flex-direction: column; gap: 2px;
        }

        .slot.matched { opacity: 1; box-shadow: inset 0 0 0 5px var(--score-win); transform: scale(1.02); z-index: 5; }
        .slot.matched::after { content: '‚úì'; position: absolute; top: -10px; right: -10px; background: var(--score-win); color: black; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }

        /* Login */
        .view-login { text-align: center; width: 100%; max-width: 400px; }
        .login-input { padding: 15px; width: 100%; margin-top: 15px; text-align: center; border: 2px solid #eee; border-radius: 8px; font-size: 16px; font-weight: bold; }
        .login-btn { padding: 15px; width: 100%; margin-top: 15px; background: var(--brand-red); color: white; border: none; font-weight: 900; cursor: pointer; border-radius: 8px; font-size: 16px; text-transform: uppercase; }

        /* Admin */
        #adminPanel { position: fixed; top: 60px; left: 50%; transform: translateX(-50%); background: #222; color: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); z-index: 3000; display: none; flex-direction: column; gap: 10px; width: 500px; border: 2px solid var(--brand-red); }
        .admin-toggle-list { max-height: 400px; overflow-y: auto; display: flex; flex-direction: column; gap: 6px; }
        .admin-item { display: flex; align-items: center; gap: 12px; padding: 10px; background: #333; cursor: pointer; font-size: 13px; border-radius: 4px; border: 1px solid #444; }
        .admin-item.checked { background: var(--brand-red); color: white; border-color: var(--brand-red); font-weight: bold; }
        
        .leaderboard { flex: 1; overflow-y: auto; padding: 10px; }
        .lb-row { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
    </style>
</head>
<body>

<header>
    <div class="user-profile">
        <div class="status-dot" id="connectionDot" style="background:#e10600"></div>
        <span id="displayTeamName">OFFLINE</span>
    </div>
    <div class="header-title" ondblclick="toggleAdmin()">F1 <span style="color:var(--brand-red)">2026</span> BINGO</div>
    <button onclick="saveLocal()" style="background:var(--brand-red); color:white; border:none; padding:8px 20px; border-radius:20px; font-weight:bold; cursor:pointer;">SAVE</button>
</header>

<div id="adminPanel">
    <h3 style="margin:0; color:var(--brand-red); display:flex; justify-content:space-between;">
        RACE CONTROL <span onclick="toggleAdmin()" style="cursor:pointer;">&times;</span>
    </h3>
    <div style="font-size:11px; color:#aaa; margin-bottom:10px;">Select confirmed events.</div>
    <div class="admin-toggle-list" id="adminList"></div>
    <button onclick="publishResults()" style="background:var(--score-win); color:black; border:none; padding:12px; font-weight:bold; cursor:pointer; margin-top:15px; border-radius:6px;">PUBLISH RESULTS</button>
</div>

<div class="race-bar" id="raceBar"></div>

<div class="main-stage">
    
    <div class="panel">
        <div class="panel-header">Card Builder</div>
        <div class="builder-container" id="builderView" style="display:none;">
            
            <div>
                <div class="builder-label">1. Select Driver</div>
                <select id="driverSelect" class="builder-select">
                    <option value="" disabled selected>Choose Driver...</option>
                </select>
            </div>

            <div>
                <div class="builder-label">2. Select Outcome</div>
                <select id="outcomeSelect" class="builder-select">
                    <option value="" disabled selected>Choose Result...</option>
                </select>
            </div>

            <button class="add-btn" onclick="addToGrid()">Add to Selected Slot</button>

            <div class="chaos-list">
                <div class="builder-label">Or Add Chaos Event</div>
                <div id="chaosContainer"></div>
            </div>
            
            <div style="margin-top:20px; font-size:11px; color:#888; text-align:center;">
                Click a slot on the grid, then select options above to fill it.
            </div>
        </div>
        <div id="builderPlaceholder" style="padding:20px; text-align:center; color:#999; font-size:13px;">Login to build card.</div>
    </div>

    <div class="active-panel" id="mainPanel">
        <div id="view-login" class="view-login">
            <h1 style="font-style:italic; font-size:28px;">TEAM PRINCIPAL LOGIN</h1>
            <p style="color:#888; margin-bottom:20px;">Enter your credentials to access the 2026 Paddock.</p>
            <input type="text" id="teamNameInput" class="login-input" placeholder="e.g. Red Bull Ringers">
            <button class="login-btn" onclick="login()">ENTER PADDOCK</button>
        </div>

        <div id="view-game" class="view-game hidden" style="width:100%; height:100%;">
            <div id="grid" class="bingo-grid"></div>
        </div>
    </div>

    <div class="panel">
        <div class="panel-header">Standings</div>
        <div style="padding:15px; text-align:center; font-weight:800; font-size:18px; color:var(--brand-red);" id="scoreDisplay">0 PTS</div>
        <div class="leaderboard" id="leaderboardList"></div>
    </div>
</div>

<script>
    // --- STATE ---
    let currentUser = null;
    let activeRace = 'aus';
    let currentGrid = Array(25).fill(null);
    let selectedSlotIndex = null;
    let verifiedResults = [];

    // --- INIT ---
    window.onload = function() {
        if (typeof BINGO_CONFIG === 'undefined') {
            alert("Error: bingo_data.js not found!"); return;
        }
        renderRaces();
        populateBuilder();
        
        // Auto-login check
        const savedName = localStorage.getItem('f1_team_name');
        if(savedName) document.getElementById('teamNameInput').value = savedName;
    };

    function populateBuilder() {
        const dSelect = document.getElementById('driverSelect');
        const oSelect = document.getElementById('outcomeSelect');
        const cContainer = document.getElementById('chaosContainer');

        // Drivers
        BINGO_CONFIG.drivers.forEach(d => {
            let opt = document.createElement('option');
            opt.value = d.name;
            opt.innerText = `${d.name} (${d.team})`;
            dSelect.appendChild(opt);
        });

        // Outcomes
        BINGO_CONFIG.outcomes.forEach(o => {
            let opt = document.createElement('option');
            opt.value = o;
            opt.innerText = o;
            oSelect.appendChild(opt);
        });

        // Chaos
        BINGO_CONFIG.chaos.forEach(c => {
            let div = document.createElement('div');
            div.className = 'chaos-chip';
            div.innerText = c;
            div.onclick = () => addChaosToGrid(c);
            cContainer.appendChild(div);
        });
    }

    // --- LOGIC ---
    function login() {
        const name = document.getElementById('teamNameInput').value.trim();
        if (!name) return alert("Enter Name");
        currentUser = name;
        localStorage.setItem('f1_team_name', name);
        document.getElementById('displayTeamName').innerText = name.toUpperCase();
        document.getElementById('builderPlaceholder').style.display = 'none';
        document.getElementById('builderView').style.display = 'flex';
        
        checkLocalGrid();
    }

    function checkLocalGrid() {
        const savedGrid = localStorage.getItem(`grid_${activeRace}`);
        const savedRes = localStorage.getItem(`results_${activeRace}`);
        if(savedRes) verifiedResults = JSON.parse(savedRes);
        
        if (savedGrid) {
            currentGrid = JSON.parse(savedGrid);
        } else {
            // New Grid - Center Free Space
            currentGrid = Array(25).fill(null);
            currentGrid[12] = { text: "üèÅ FREE", type: "FREE" };
        }
        
        document.getElementById('view-login').classList.add('hidden');
        document.getElementById('view-game').classList.remove('hidden');
        renderGrid();
    }

    function renderGrid() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        
        currentGrid.forEach((cell, i) => {
            const slot = document.createElement('div');
            slot.dataset.index = i;
            slot.onclick = () => selectSlot(i);
            
            if (i === 12) {
                slot.className = 'slot center matched';
                slot.innerHTML = "üèÅ<br>FREE";
            } else if (cell) {
                slot.className = 'slot filled';
                slot.innerText = cell.text;
                if (verifiedResults.includes(cell.text)) slot.classList.add('matched');
            } else {
                slot.className = 'slot';
                slot.innerText = (selectedSlotIndex === i) ? "SELECTING..." : "EMPTY";
                if (selectedSlotIndex === i) slot.classList.add('selected-target');
            }
            grid.appendChild(slot);
        });
        updateScore();
    }

    function selectSlot(index) {
        if (index === 12) return;
        selectedSlotIndex = index;
        renderGrid();
    }

    function addToGrid() {
        if (selectedSlotIndex === null) return alert("Click a slot on the grid first!");
        
        const driver = document.getElementById('driverSelect').value;
        const result = document.getElementById('outcomeSelect').value;
        
        if (!driver || !result) return alert("Select both Driver and Outcome");
        
        const text = `${driver}\n${result}`;
        currentGrid[selectedSlotIndex] = { text: text, type: "manual" };
        
        renderGrid();
        saveLocal();
        
        // Reset selections
        document.getElementById('driverSelect').value = "";
        document.getElementById('outcomeSelect').value = "";
        selectedSlotIndex = null;
    }

    function addChaosToGrid(text) {
        if (selectedSlotIndex === null) return alert("Click a slot on the grid first!");
        currentGrid[selectedSlotIndex] = { text: text, type: "chaos" };
        renderGrid();
        saveLocal();
        selectedSlotIndex = null;
    }

    function renderRaces() {
        const bar = document.getElementById('raceBar');
        bar.innerHTML = '';
        BINGO_CONFIG.races.forEach(r => {
            const div = document.createElement('div');
            div.className = `race-card ${r.id === activeRace ? 'active' : ''}`;
            div.onclick = () => { activeRace = r.id; renderRaces(); checkLocalGrid(); };
            div.innerHTML = `<img src="https://flagcdn.com/w40/${r.c}.png" class="race-flag-img"><span class="race-name">${r.n}</span>`;
            bar.appendChild(div);
        });
    }

    // --- ADMIN ---
    function toggleAdmin() {
        const p = document.getElementById('adminPanel');
        if(p.style.display === 'flex') {
            p.style.display = 'none';
        } else {
            p.style.display = 'flex';
            const list = document.getElementById('adminList');
            list.innerHTML = '';
            
            // Build list of all currently used items in the grid
            let itemsOnGrid = currentGrid.filter(c => c && c.type !== 'FREE').map(c => c.text);
            // Remove duplicates
            itemsOnGrid = [...new Set(itemsOnGrid)];
            
            if(itemsOnGrid.length === 0) list.innerHTML = "<div style='padding:10px; color:#666;'>Grid is empty. Fill grid to see options.</div>";

            itemsOnGrid.forEach(text => {
                const item = document.createElement('div');
                const isChecked = verifiedResults.includes(text);
                item.className = `admin-item ${isChecked ? 'checked' : ''}`;
                item.innerText = text.replace(/\n/g, " - ");
                item.onclick = () => item.classList.toggle('checked');
                list.appendChild(item);
            });
        }
    }

    function publishResults() {
        const checked = document.querySelectorAll('.admin-item.checked');
        verifiedResults = Array.from(checked).map(el => el.innerText.replace(" - ", "\n"));
        localStorage.setItem(`results_${activeRace}`, JSON.stringify(verifiedResults));
        renderGrid();
        toggleAdmin();
    }

    function updateScore() {
        let score = 0;
        currentGrid.forEach((item, i) => {
            if (!item) return;
            if (i === 12) { score += 10; return; }
            if (verifiedResults.includes(item.text)) score += 10;
        });
        document.getElementById('scoreDisplay').innerText = `${score} PTS`;
    }

    function saveLocal() {
        localStorage.setItem(`grid_${activeRace}`, JSON.stringify(currentGrid));
    }

</script>

</body>
</html>